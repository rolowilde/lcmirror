---
- name: Configure a repository mirror server
  hosts: mirrors
  become: true
  roles:
    - role: common
      tags: always

    - role: robertdebock.update
      tags: update

    - role: robertdebock.users
      vars:
        users: "{{ common_users | default([]) }}"
      tags: users

    - role: archlinux
      tags: archlinux
      when: archlinux | default(True)

    - role: debian
      tags: debian
      when: debian | default(True)

    - role: ubuntu
      tags: ubuntu
      when: ubuntu | default(True)

    - role: freebsd
      tags: freebsd
      when: freebsd | default(True)

    - role: mxlinux
      tags: mxlinux
      when: mxlinux | default(True)

    - role: linuxmint
      tags: linuxmint
      when: linuxmint | default(True)

    - role: maxhoesel.caddy.caddy_server
      tags: caddy
      when: caddy | default(True)

    - role: infOpen.rsync-server
      vars:
        rsync_server_group:
          name: "{{ common_rsync_user }}"
        rsync_server_user:
          name: "{{ common_rsync_user }}"
        rsync_default_global_config: |-
          uid = {{ common_rsync_user }}
          gid = {{ common_rsync_user }}
          log file = /var/log/rsync/rsyncd.log
        rsync_server_config_main:
          global: "{{ rsync_global_config | default(rsync_default_global_config) }}"
          modules: "{{ common_rsync_modules | default([]) }}"
        rsync_server_service: true
      tags: rsyncd
      when: rsyncd | default(True)

    - role: robertdebock.vsftpd
      tags: vsftpd
      when: vsftpd | default(True)

    - role: robertdebock.cron
      vars:
        cron_jobs: "{{ common_cron_jobs | default([]) }}"
      tags: cron
